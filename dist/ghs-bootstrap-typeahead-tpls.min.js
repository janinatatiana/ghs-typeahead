/*
 * ghs-typeahead
 * http://angular-ui.github.io/bootstrap/

 * Version: 0.15.1 - 2016-07-12
 * License: MIT
 */
angular.module("ghs.bootstrap",["ghs.bootstrap.tpls","ghs.bootstrap.typeahead"]),angular.module("ghs.bootstrap.tpls",["template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("ghs.bootstrap.typeahead",["ui.bootstrap.position"]).factory("ghsTypeaheadParser",["$parse",function(a){var b=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(c){var d=c.match(b);if(!d)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+c+'".');return{itemName:d[3],source:a(d[4]),viewMapper:a(d[2]||d[1]),modelMapper:a(d[1])}}}}]).directive("ghsTypeahead",["$compile","$parse","$q","$timeout","$document","$uibPosition","ghsTypeaheadParser",function(a,b,c,d,e,f,g){var h=[9,13,27,38,40];return{require:"ngModel",link:function(i,j,k,l){function m(a){for(var b=0,c=a.target;c&&4>=b;c=c.parentNode){if(c===j[0]||c===j[0].nextSibling)return!0;b++}return!1}var n=(i.$eval(k.typeaheadMinLength)||1,i.$eval(k.typeaheadWaitMs)||0),o=i.$eval(k.typeaheadEditable)!==!1,p=b(k.typeaheadLoading).assign||angular.noop,q=i.$eval(k.typeaheadParentTemplate)||"",r=b(k.typeaheadOnSelect),s=b(k.typeaheadOnClose)||angular.noop,t=k.typeaheadInputFormatter?b(k.typeaheadInputFormatter):void 0,u=k.typeaheadAppendToBody?i.$eval(k.typeaheadAppendToBody):!1,v=b(k.ngModel).assign,w=g.parse(k.ghsTypeahead),x=!0,y=!0,z=!1,A=k.exposeReload?i.$eval(k.exposeReload):!1,B=i.$new();i.$on("$destroy",function(){B.$destroy()}),B.popupState={visible:!1},B.matches=[];var C="typeahead-"+B.$id+"-"+Math.floor(1e4*Math.random());j.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":C});var D=function(){x&&!B.popupState.visible&&(B.popupState.visible=!0,H(l.$viewValue))};j.on("click",function(){D()}),j.on("focus",function(){D()});var E=angular.element("<div ghs-typeahead-popup></div>");E.attr({id:C,matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position","popup-state":"popupState",parentTemplate:q}),angular.isDefined(k.typeaheadTemplateUrl)&&E.attr("template-url",k.typeaheadTemplateUrl);var F=function(){s(i),B.activeIdx=-1,B.popupState.visible=!1,j.attr("aria-expanded",!1)},G=function(a){return C+"-option-"+a};B.$watch("activeIdx",function(a){0>a?j.removeAttr("aria-activedescendant"):j.attr("aria-activedescendant",G(a))});var H=function(a){var b={$viewValue:a};p(i,!0),c.when(w.source(i,b)).then(function(c){var d=a===l.$viewValue;if(d&&B.popupState.visible)if(P(),c.length>0){B.activeIdx=-1,B.matches.length=0;for(var e=0;e<c.length;e++)b[w.itemName]=c[e],B.matches.push({id:G(e),label:w.viewMapper(B,b),model:c[e]});B.query=a,B.position=u?f.offset(j):f.position(j),B.position.top=B.position.top+j.prop("offsetHeight"),j.attr("aria-expanded",!0)}else B.matches.length=0,F();d&&p(i,!1)},function(){F(),p(i,!1)})};A&&(i.ngTypeaheadReload=H),F(),B.query=void 0;var I,J,K,L=function(a){I=d(function(){H(a)},n)},M=function(){I&&d.cancel(I)},N=function(){O(),x=!1,J=d(function(){x=!0,B.$digest()},250)},O=function(){J&&d.cancel(J)},P=function(){Q(),y=!1,K=d(function(){y=!0,B.$digest()},250)},Q=function(){K&&d.cancel(K)};l.$parsers.unshift(function(a){return B.popupState.visible=!0,n>0?(M(),L(a)):H(a),o?a:a?void l.$setValidity("editable",!1):(l.$setValidity("editable",!0),a)}),l.$formatters.push(function(a){var b,c,d={};return t?(d.$model=a,t(i,d)):(d[w.itemName]=a,b=w.viewMapper(i,d),d[w.itemName]=void 0,c=w.viewMapper(i,d),b!==c?b:a)}),B.select=function(a){var b,c,e={};y&&a>=0&&B.matches.length&&(e[w.itemName]=c=B.matches[a].model,c.ngDisabled||(b=w.modelMapper(i,e),v(i,b),l.$setValidity("editable",!0),r(i,{$item:c,$model:b,$label:w.viewMapper(i,e)}),N(),F(),d(function(){j[0].focus()},0,!1)))},j.bind("keydown",function(a){B.popupState.visible&&-1!==h.indexOf(a.which)&&(40===a.which?(a.preventDefault(),B.activeIdx=(B.activeIdx+1)%B.matches.length,B.$digest()):38===a.which?(a.preventDefault(),-1===B.activeIdx&&(B.activeIdx=0),B.activeIdx=(B.activeIdx?B.activeIdx:B.matches.length)-1,B.$digest()):13===a.which||9===a.which?-1!==B.activeIdx?(a.preventDefault(),B.$apply(function(){B.select(B.activeIdx)})):(F(),B.$digest()):27===a.which&&(a.preventDefault(),a.stopPropagation(),F(),B.$digest()))});var R=function(a){!y||z||m(a)||(F(),B.$digest())},S=function(a){z=!1},T=function(a){z=!0};e.bind("touchstart",S),e.bind("touchmove",T),e.bind("click touchend",R),i.$on("$destroy",function(){e.unbind("touchstart",S),e.unbind("touchmove",T),e.unbind("click touchend",R)});var U=a(E)(B);u?e.find("body").append(U):j.after(U)}}}]).directive("ghsTypeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&",popupState:"="},replace:!0,templateUrl:function(a,b){var c=""!==b.parenttemplate?b.parenttemplate:"typeahead-popup";return"template/typeahead/"+c+".html"},link:function(a,b,c){a.templateUrl=c.templateUrl,a.isOpen=function(){return a.popupState.visible&&a.matches.length>0},a.isActive=function(b){return a.active==b},a.selectActive=function(b){a.active=b},a.selectMatch=function(b){a.select({activeIdx:b})}}}}).directive("ghsTypeaheadMatch",["$http","$templateCache","$compile","$parse",function(a,b,c,d){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(e,f,g){var h=d(g.templateUrl)(e.$parent)||"template/typeahead/typeahead-match.html";a.get(h,{cache:b}).success(function(a){f.replaceWith(c(a.trim())(e))})}}}]).filter("ghsTypeaheadHighlight",["$injector","$sce",function(a,b){function c(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function d(a){return/<.*>/g.test(a)}var e;return e=a.has("$sanitize"),function(a,f){return!e&&d(a)&&$log.warn("Unsafe use of typeahead please use ngSanitize"),a=f?(""+a).replace(new RegExp(c(f),"gi"),"<strong>$&</strong>"):a,e||(a=b.trustAsHtml(a)),a}}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function(a){a.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" ng-bind-html="match.label | ghsTypeaheadHighlight:query"></a>\n')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function(a){a.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-show="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: \'100%\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">\n    <li ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{match.id}}">\n        <div ghs-typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>\n')}]);